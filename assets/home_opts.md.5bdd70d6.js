import{_ as s,c as a,o as n,b as l}from"./app.3ec6974f.js";const A=JSON.parse('{"title":"broadcast-message\u9009\u9879","description":"","frontmatter":{},"headers":[{"level":2,"title":"channelId","slug":"channelid","link":"#channelid","children":[]},{"level":2,"title":"allowLocalBroadcast","slug":"allowlocalbroadcast","link":"#allowlocalbroadcast","children":[]},{"level":2,"title":"emitOriginalMessage","slug":"emitoriginalmessage","link":"#emitoriginalmessage","children":[]},{"level":2,"title":"targetOrigin","slug":"targetorigin","link":"#targetorigin","children":[]},{"level":2,"title":"transportType","slug":"transporttype","link":"#transporttype","children":[]},{"level":2,"title":"inTrustedDomainPages","slug":"intrusteddomainpages","link":"#intrusteddomainpages","children":[]},{"level":2,"title":"trustedDomainPages","slug":"trusteddomainpages","link":"#trusteddomainpages","children":[]},{"level":2,"title":"debug","slug":"debug","link":"#debug","children":[]},{"level":2,"title":"\u5B8C\u6574\u9009\u9879","slug":"\u5B8C\u6574\u9009\u9879","link":"#\u5B8C\u6574\u9009\u9879","children":[]}],"relativePath":"home/opts.md"}'),p={name:"home/opts.md"},o=l(`<h1 id="broadcast-message\u9009\u9879" tabindex="-1">broadcast-message\u9009\u9879 <a class="header-anchor" href="#broadcast-message\u9009\u9879" aria-hidden="true">#</a></h1><p><code>new BroadcastMessage(opts)</code> \u4E2D\u7684opts\u662F\u4E00\u4E2A\u5BF9\u8C61\u5B83\u5305\u542B\u7684\u9009\u9879\u548C\u5177\u4F53\u8BF4\u660E\u5982\u4E0B\uFF1A</p><h2 id="channelid" tabindex="-1">channelId <a class="header-anchor" href="#channelid" aria-hidden="true">#</a></h2><p>\u6307\u5B9ABroadcastMessage\u7684\u6D88\u606F\u9891\u9053id\uFF0C\u4E0D\u540CBroadcastMessage\u5B9E\u4F8B\uFF0C\u53EA\u8981channelId\u4E00\u81F4\u5373\u53EF\u901A\u4FE1<br> \u9ED8\u8BA4\u7684channelId\u4E3A&quot;*&quot; , \u8FD9\u610F\u5473\u7740\u5728\u4E0D\u6307\u5B9A\u9891\u9053id\u7684\u60C5\u51B5\u4E0B\uFF0C\u5404\u4E2A\u5B9E\u4F8B\u7684\u6D88\u606F\u90FD\u4F1A\u53D1\u5F80\u540C\u4E00\u4E2A\u9891\u9053\u4E0A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">channelId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="allowlocalbroadcast" tabindex="-1">allowLocalBroadcast <a class="header-anchor" href="#allowlocalbroadcast" aria-hidden="true">#</a></h2><p>\u5141\u8BB8\u65E2\u662F\u6D88\u606F\u7684\u53D1\u9001\u9875\uFF0C\u4E5F\u53EF\u4EE5\u662F\u6D88\u606F\u7684\u63A5\u6536\u9875\uFF0C\u4ECE\u800C\u505A\u5230\u540C\u6E90\u540C\u9875\u6536\u53D1\u6D88\u606F<br> postMessage\u3001BroadcastChannel\u548Cstorage\u4E8B\u4EF6\u90FD\u662F\u5FC5\u987B\u4E00\u4E2A\u9875\u9762\u53D1\u9001\uFF0C\u53E6\u4E00\u4E2A\u9875\u9762\u63A5\u6536<br> \u800CBroadcastMessage\u5141\u8BB8\u540C\u9875\u9762\u6536\u53D1\u6D88\u606F\uFF0C\u53EA\u9700\u5C06allowLocalBroadcast\u8BBE\u4E3Atrue\u5373\u53EF</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">allowLocalBroadcast</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="emitoriginalmessage" tabindex="-1">emitOriginalMessage <a class="header-anchor" href="#emitoriginalmessage" aria-hidden="true">#</a></h2><p>\u7ED9 broadcastMessage.addEventListener(&quot;message&quot;, function (event) {}) \u4E8B\u4EF6\u6D3E\u53D1\u539F\u59CB\u6D88\u606F\u5BF9\u8C61<br> \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CbroadcastMessage.postMessage(msg) \u4E2D\u7684 msg \u7B49\u4E8E\u63A5\u6536\u5230\u7684 event.data\uFF0C\u4F46\u5176\u5B9E\u4E3A\u4E86\u80FD\u51C6\u786E\u6D3E\u9001\u6D88\u606F\uFF0C msg\u4F1A\u88AB\u5305\u88C5\u6210\u6709\u5F88\u591A\u8F85\u52A9\u53C2\u6570\u7684\u5BF9\u8C61\uFF0C\u5982\u679C\u4F60\u9700\u8981\u8FD9\u4E9B\u8F85\u52A9\u53C2\u6570\u4FE1\u606F\uFF0C\u53EF\u4EE5\u5C06emitOriginalMessage\u8BBE\u4E3Atrue</p><p>\u5219\u6536\u5230\u7684event.data\u5C06\u662F\u5982\u4E0B\u7684\u5BF9\u8C61\u5B9E\u4F53\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">event</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> msg</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">                   </span><span style="color:#676E95;">// \u6D88\u606F\u672C\u4F53</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">BroadcastMessage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;">// \u6D88\u606F\u7C7B\u578B\uFF0C\u9ED8\u8BA4\u4E3ABroadcastMessage\uFF0C\u5176\u4ED6\u7C7B\u578B\uFF0C\u5219\u662F\u81EA\u5B9A\u4E49\u6D88\u606F\u6216\u5185\u90E8\u6D88\u606F</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">origin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">                  </span><span style="color:#676E95;">// \u6D88\u606F\u6765\u6E90\u7684\u57DF\u540D\u5730\u5740</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">targetOrigin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">            </span><span style="color:#676E95;">// \u6D88\u606F\u76EE\u6807\u6E90\u7684\u57DF\u540D\u5730\u5740</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">referrer</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;">// \u6D88\u606F\u6765\u81EA\u54EA\u4E2A\u9875\u9762</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">timeStamp</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">               </span><span style="color:#676E95;">// \u6D88\u606F\u53D1\u51FA\u65F6\u7684\u65F6\u95F4\u6233</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">transportType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">           </span><span style="color:#676E95;">// \u4E2D\u8F6C\u6D88\u606F\u7684\u8F7D\u4F53\u7C7B\u578B\uFF0C\u53EA\u53EF\u80FD\u4E3ABroadcastMessage\u548ClocalStorage</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">allowLocalBroadcast</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">// \u8BE5\u6D88\u606F\u662F\u5426\u5141\u8BB8\u88AB\u540C\u9875\u9762\u7684BroadcastMessage\u5B9E\u4F8B\u63A5\u6536\u5230</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">channelId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">              </span><span style="color:#676E95;">// \u6D88\u606F\u6240\u5C5E\u7684\u9891\u9053id</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">instanceId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xx_xx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">         </span><span style="color:#676E95;">// \u6D88\u606F\u6240\u5C5EBroadcastMessage\u5B9E\u4F8Bid</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F07178;">debug</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#A6ACCD;">                 </span><span style="color:#676E95;">// \u662F\u5426\u4E3A\u5F00\u542F\u4E86\u8C03\u8BD5\u9009\u9879\u7684\u6D88\u606F</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">emitOriginalMessage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="targetorigin" tabindex="-1">targetOrigin <a class="header-anchor" href="#targetorigin" aria-hidden="true">#</a></h2><p>\u6307\u5B9A\u6D88\u606F\u53D1\u9001\u7684\u76EE\u6807\u57DF\uFF0C\u89C4\u5219\u8DDFpostMessage\u7684targetOrigin\u4E00\u6837<br> \u4F46\u4E0D\u540C\u7684\u662F\u652F\u6301\u5B9A\u4E49\u6570\u7EC4\u5F62\u5F0F\u7684targetOrigin\uFF0C\u4ECE\u800C\u5B9E\u73B0\u6279\u91CF\u8DE8\u57DF\u6570\u636E\u53D1\u9001<br> \u5F53\u7136\u5982\u679C\u662F&quot;*&quot;\u7684\u8BDD\u5C31\u662F\u7ED9\u4EFB\u610F\u8FD0\u884C\u4E86\u672C\u63D2\u4EF6\u7684\u9875\u9762\u53D1\u9001\u6570\u636E \u9ED8\u8BA4\u4E3A <code>location.origin</code>\uFF0C\u5373\u53EA\u53EF\u4EE5\u5728\u540C\u57DF\u540D\u7684\u9875\u9762\u4E4B\u95F4\u8FDB\u884C\u901A\u4FE1</p><p>\u66F4\u591A\u5173\u4E8EtargetOrigin\u7684\u8BE6\u7EC6\u8BF4\u660E\uFF0C\u548C\u76F8\u5173\u7684\u5B89\u5168\u95EE\u9898\uFF0C\u53C2\u89C1\uFF1A<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noreferrer">postMessage</a></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">targetOrigin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">origin</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u540C\u65F6\u914D\u7F6E\u591A\u4E2AtargetOrigin\u7684\u793A\u4F8B\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">targetOrigin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://domainA.xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://domainB.xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="transporttype" tabindex="-1">transportType <a class="header-anchor" href="#transporttype" aria-hidden="true">#</a></h2><p>\u6307\u5B9A\u6570\u636E\u4E2D\u8F6C\u4F20\u8F93\u4F7F\u7528\u7684\u4F20\u8F93\u7C7B\u578B\uFF0C\u53EF\u9009\u503C\uFF1ABroadcastChannel\u3001localStorage<br> \u4E0D\u6307\u5B9A\u7684\u8BDD\uFF0C\u4F18\u5148\u4F7F\u7528BroadcastChannel\uFF0C\u5728\u4E0D\u517C\u5BB9BroadcastChannel\u7684\u6D4F\u89C8\u5668\u4E0B\u4F7F\u7528localStorage<br> \u65E0\u7279\u9700\u60C5\u51B5\uFF0C\u4E0D\u5EFA\u8BAE\u4FEE\u6539\u8BE5\u9879\u914D\u7F6E</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">transportType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">BroadcastChannel</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="intrusteddomainpages" tabindex="-1">inTrustedDomainPages <a class="header-anchor" href="#intrusteddomainpages" aria-hidden="true">#</a></h2><p>\u6807\u8BC6BroadcastMessage\u5B9E\u4F8B\u662F\u5426\u5904\u4E8E\u53EF\u4FE1\u57DF\u7684\u9875\u9762\u4E0A\u8FD0\u884C<br> \u5982\u679C\u662F\uFF0C\u5F53\u524D\u9875\u9762\u4F5C\u4E3A\u53EF\u4FE1\u57DF\u7684\u4E2D\u4ECB\u9875\u5D4C\u5165\u5230\u5177\u4F53\u8FD0\u884C\u73AF\u5883\u4E2D<br> \u8BE5\u9009\u9879\u53EA\u5728\u81EA\u5B9A\u4E49\u53EF\u4FE1\u57DF\u9875\u9762\u4E2D\u4F7F\u7528\uFF0C\u5176\u4ED6\u60C5\u51B5\u4E0D\u8981\u4F7F\u7528</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">inTrustedDomainPages</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="trusteddomainpages" tabindex="-1">trustedDomainPages <a class="header-anchor" href="#trusteddomainpages" aria-hidden="true">#</a></h2><p>\u6307\u5B9A\u4F5C\u4E3A\u6D88\u606F\u4E2D\u8F6C\u7684\u53EF\u4FE1\u57DF\u9875\u9762\u5730\u5740\uFF0C\u6709\u9700\u8DE8\u57DF\u901A\u4FE1\u9700\u6C42\u624D\u4F1A\u7528\u5230\u8BE5\u9009\u9879<br> \u5B98\u65B9\u63D0\u4F9B\u7684\u53EF\u4FE1\u57DF\u9875\u9762\u5730\u5740\u4E3A\uFF1A<br><a href="https://broadcast-message.anzz.top/dist/pages/broadcast-message.html" target="_blank" rel="noreferrer">https://broadcast-message.anzz.top/dist/pages/broadcast-message.html</a></p><p>\u9700\u81EA\u5B9A\u4E49\u53EF\u4FE1\u57DF\u9875\u9762\u7684\uFF0C\u89C1<a href="/home/examples.html#\u81EA\u5B9A\u4E49\u53EF\u4FE1\u57DF\u9875\u9762">\u81EA\u5B9A\u4E49\u53EF\u4FE1\u57DF\u9875\u9762</a></p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">trustedDomainPages</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="debug" tabindex="-1">debug <a class="header-anchor" href="#debug" aria-hidden="true">#</a></h2><p>\u6807\u8BC6\u662F\u5426\u5F00\u542F\u8C03\u8BD5\u9009\u9879<br> \u5F53debug\u9009\u9879\u548CemitOriginalMessage\u9009\u9879\u540C\u65F6\u4E3Atrue\u65F6\uFF0C\u4F60\u5728\u4FE1\u606F\u7684\u63A5\u6536\u7AEF\u5C06\u80FD\u6536\u5230\u5E26\u6709debug\u9009\u9879\u7684\u4FE1\u606F\uFF0C\u5BF9\u4E8E\u67D0\u4E9B\u573A\u666F\u6216\u8BB8\u6709\u6240\u5E2E\u52A9</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">debug</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><h2 id="\u5B8C\u6574\u9009\u9879" tabindex="-1">\u5B8C\u6574\u9009\u9879 <a class="header-anchor" href="#\u5B8C\u6574\u9009\u9879" aria-hidden="true">#</a></h2><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> bmOpts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u6307\u5B9ABroadcastMessage\u7684\u6D88\u606F\u9891\u9053id\uFF0C\u4E0D\u540CBroadcastMessage\u5B9E\u4F8B\uFF0C\u53EA\u8981channelId\u4E00\u81F4\u5373\u53EF\u901A\u4FE1</span></span>
<span class="line"><span style="color:#676E95;">   * \u9ED8\u8BA4\u7684channelId\u4E3A&quot;*&quot; , \u8FD9\u610F\u5473\u7740\u5728\u4E0D\u6307\u5B9A\u9891\u9053id\u7684\u60C5\u51B5\u4E0B\uFF0C\u5404\u4E2A\u5B9E\u4F8B\u7684\u6D88\u606F\u90FD\u4F1A\u53D1\u5F80\u540C\u4E00\u4E2A\u9891\u9053\u4E0A</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">channelId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u5141\u8BB8\u65E2\u662F\u6D88\u606F\u7684\u53D1\u9001\u9875\uFF0C\u4E5F\u53EF\u4EE5\u662F\u6D88\u606F\u7684\u63A5\u6536\u9875\uFF0C\u4ECE\u800C\u505A\u5230\u540C\u6E90\u540C\u9875\u6536\u53D1\u6D88\u606F</span></span>
<span class="line"><span style="color:#676E95;">   * postMessage\u3001BroadcastChannel\u548Cstorage\u4E8B\u4EF6\u90FD\u662F\u5FC5\u987B\u4E00\u4E2A\u9875\u9762\u53D1\u9001\uFF0C\u53E6\u4E00\u4E2A\u9875\u9762\u63A5\u6536</span></span>
<span class="line"><span style="color:#676E95;">   * \u800CBroadcastMessage\u5141\u8BB8\u540C\u9875\u9762\u6536\u53D1\u6D88\u606F\uFF0C\u53EA\u9700\u5C06allowLocalBroadcast\u8BBE\u4E3Atrue\u5373\u53EF</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">allowLocalBroadcast</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u7ED9 broadcastMessage.addEventListener(&quot;message&quot;, function (event) {}) \u4E8B\u4EF6\u6D3E\u53D1\u539F\u59CB\u6D88\u606F\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#676E95;">   * \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0CbroadcastMessage.postMessage(msg) \u4E2D\u7684 msg \u7B49\u4E8E\u63A5\u6536\u5230\u7684 event.data\uFF0C\u4F46\u5176\u5B9E\u4E3A\u4E86\u80FD\u51C6\u786E\u6D3E\u9001\u6D88\u606F\uFF0C</span></span>
<span class="line"><span style="color:#676E95;">   * msg\u4F1A\u88AB\u5305\u88C5\u6210\u6709\u5F88\u591A\u8F85\u52A9\u53C2\u6570\u7684\u5BF9\u8C61\uFF0C\u5982\u679C\u4F60\u9700\u8981\u8FD9\u4E9B\u8F85\u52A9\u53C2\u6570\u4FE1\u606F\uFF0C\u53EF\u4EE5\u5C06emitOriginalMessage\u8BBE\u4E3Atrue</span></span>
<span class="line"><span style="color:#676E95;">   * \u5219\u6536\u5230\u7684event.data\u5C06\u662F\u5982\u4E0B\u7684\u5BF9\u8C61\u5B9E\u4F53\uFF1A</span></span>
<span class="line"><span style="color:#676E95;">   * event.data = {</span></span>
<span class="line"><span style="color:#676E95;">   *    data: msg,                   // \u6D88\u606F\u672C\u4F53</span></span>
<span class="line"><span style="color:#676E95;">   *    type: &#39;BroadcastMessage&#39;,    // \u6D88\u606F\u7C7B\u578B\uFF0C\u9ED8\u8BA4\u4E3ABroadcastMessage\uFF0C\u5176\u4ED6\u7C7B\u578B\uFF0C\u5219\u662F\u81EA\u5B9A\u4E49\u6D88\u606F\u6216\u5185\u90E8\u6D88\u606F</span></span>
<span class="line"><span style="color:#676E95;">   *    origin: &#39;&#39;,                  // \u6D88\u606F\u6765\u6E90\u7684\u57DF\u540D\u5730\u5740</span></span>
<span class="line"><span style="color:#676E95;">   *    targetOrigin: &#39;&#39;,            // \u6D88\u606F\u76EE\u6807\u6E90\u7684\u57DF\u540D\u5730\u5740</span></span>
<span class="line"><span style="color:#676E95;">   *    referrer: &#39;&#39;,                // \u6D88\u606F\u6765\u81EA\u54EA\u4E2A\u9875\u9762</span></span>
<span class="line"><span style="color:#676E95;">   *    timeStamp: &#39;&#39;,               // \u6D88\u606F\u53D1\u51FA\u65F6\u7684\u65F6\u95F4\u6233</span></span>
<span class="line"><span style="color:#676E95;">   *    transportType: &#39;&#39;,           // \u4E2D\u8F6C\u6D88\u606F\u7684\u8F7D\u4F53\u7C7B\u578B\uFF0C\u53EA\u53EF\u80FD\u4E3ABroadcastMessage\u548ClocalStorage</span></span>
<span class="line"><span style="color:#676E95;">   *    allowLocalBroadcast: false,  // \u8BE5\u6D88\u606F\u662F\u5426\u5141\u8BB8\u88AB\u540C\u9875\u9762\u7684BroadcastMessage\u5B9E\u4F8B\u63A5\u6536\u5230</span></span>
<span class="line"><span style="color:#676E95;">   *    channelId: &#39;*&#39;,              // \u6D88\u606F\u6240\u5C5E\u7684\u9891\u9053id</span></span>
<span class="line"><span style="color:#676E95;">   *    instanceId: &#39;xx_xx&#39;,         // \u6D88\u606F\u6240\u5C5EBroadcastMessage\u5B9E\u4F8Bid</span></span>
<span class="line"><span style="color:#676E95;">   *    debug: false                 // \u662F\u5426\u4E3A\u5F00\u542F\u4E86\u8C03\u8BD5\u9009\u9879\u7684\u6D88\u606F</span></span>
<span class="line"><span style="color:#676E95;">   * }</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">emitOriginalMessage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u6307\u5B9A\u6D88\u606F\u53D1\u9001\u7684\u76EE\u6807\u57DF\uFF0C\u89C4\u5219\u8DDFpostMessage\u7684targetOrigin\u4E00\u6837</span></span>
<span class="line"><span style="color:#676E95;">   * \u4F46\u4E0D\u540C\u7684\u662F\u652F\u6301\u5B9A\u4E49\u6570\u7EC4\u5F62\u5F0F\u7684targetOrigin\uFF0C\u4ECE\u800C\u5B9E\u73B0\u6279\u91CF\u8DE8\u57DF\u6570\u636E\u53D1\u9001</span></span>
<span class="line"><span style="color:#676E95;">   * \u5F53\u7136\u5982\u679C\u662F&quot;*&quot;\u7684\u8BDD\u5C31\u662F\u7ED9\u4EFB\u610F\u8FD0\u884C\u4E86\u672C\u63D2\u4EF6\u7684\u9875\u9762\u53D1\u9001\u6570\u636E</span></span>
<span class="line"><span style="color:#676E95;">   * \u9ED8\u8BA4\u4E3A \`location.origin\`\uFF0C\u5373\u53EA\u53EF\u4EE5\u5728\u540C\u57DF\u540D\u7684\u9875\u9762\u4E4B\u95F4\u8FDB\u884C\u901A\u4FE1</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">targetOrigin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">origin</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u6307\u5B9A\u6570\u636E\u4E2D\u8F6C\u4F20\u8F93\u4F7F\u7528\u7684\u4F20\u8F93\u7C7B\u578B\uFF0C\u53EF\u9009\u503C\uFF1ABroadcastChannel\u3001localStorage</span></span>
<span class="line"><span style="color:#676E95;">   * \u4E0D\u6307\u5B9A\u7684\u8BDD\uFF0C\u4F18\u5148\u4F7F\u7528BroadcastChannel\uFF0C\u5728\u4E0D\u517C\u5BB9BroadcastChannel\u7684\u6D4F\u89C8\u5668\u4E0B\u4F7F\u7528localStorage</span></span>
<span class="line"><span style="color:#676E95;">   * \u65E0\u7279\u9700\u60C5\u51B5\uFF0C\u4E0D\u5EFA\u8BAE\u4FEE\u6539\u8BE5\u9879\u914D\u7F6E</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">transportType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">BroadcastChannel</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u6807\u8BC6BroadcastMessage\u5B9E\u4F8B\u662F\u5426\u5904\u4E8E\u53EF\u4FE1\u57DF\u7684\u9875\u9762\u4E0A\u8FD0\u884C</span></span>
<span class="line"><span style="color:#676E95;">   * \u5982\u679C\u662F\uFF0C\u5F53\u524D\u9875\u9762\u4F5C\u4E3A\u53EF\u4FE1\u57DF\u7684\u4E2D\u4ECB\u9875\u5D4C\u5165\u5230\u5177\u4F53\u8FD0\u884C\u73AF\u5883\u4E2D</span></span>
<span class="line"><span style="color:#676E95;">   * \u8BE5\u9009\u9879\u53EA\u5728\u81EA\u5B9A\u4E49\u53EF\u4FE1\u57DF\u9875\u9762\u4E2D\u4F7F\u7528\uFF0C\u5176\u4ED6\u60C5\u51B5\u4E0D\u8981\u4F7F\u7528</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">inTrustedDomainPages</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/**</span></span>
<span class="line"><span style="color:#676E95;">   * \u6307\u5B9A\u4F5C\u4E3A\u6D88\u606F\u4E2D\u8F6C\u7684\u53EF\u4FE1\u57DF\u9875\u9762\u5730\u5740\uFF0C\u6709\u9700\u8DE8\u57DF\u901A\u4FE1\u9700\u6C42\u624D\u4F1A\u7528\u5230\u8BE5\u9009\u9879</span></span>
<span class="line"><span style="color:#676E95;">   * \u5B98\u65B9\u63D0\u4F9B\u7684\u53EF\u4FE1\u57DF\u9875\u9762\u5730\u5740\u4E3A\uFF1A</span></span>
<span class="line"><span style="color:#676E95;">   * https://broadcast-message.anzz.top/dist/pages/broadcast-message.html</span></span>
<span class="line"><span style="color:#676E95;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">trustedDomainPages</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;">/* \u6807\u8BC6\u662F\u5426\u5F00\u542F\u8C03\u8BD5\u9009\u9879 */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">debug</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7CBE\u7B80\u6389\u6CE8\u91CA\u540E\u7684\uFF1A</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> bmOpts </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">channelId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">allowLocalBroadcast</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">emitOriginalMessage</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">targetOrigin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> location</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">origin</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">transportType</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">BroadcastChannel</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">inTrustedDomainPages</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">trustedDomainPages</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">debug</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">BroadcastMessage</span><span style="color:#A6ACCD;">(bmOpts)</span></span>
<span class="line"></span></code></pre></div>`,36),e=[o];function t(c,r,y,D,i,F){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
